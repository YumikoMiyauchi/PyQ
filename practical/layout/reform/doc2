続いて「売上データを書き出す処理」を分割して、まとめていきましょう。

元のプログラムでは全体が with open('output/sales.csv'...) で囲まれているのが問題です。
ブロックが過剰に多くなってしまうからです。

またプログラムの最後に使われている sales_f もどんな値であるか分かりにくいですし、
プログラムの最初まで読み直さないと正体が分からないので読みづらいです。

売上生データを読み込んで商品名と商品価格を含める処理はそのまま、リストに一旦保存しましょう。
一旦リストに保存しておいてから、別途ファイルに書き込むように書き換えます。

こうすることで「目的のデータを作る処理」と「ファイルに書き出す処理」にまとまりを分離できます。



売上生データを読み込む処理では sales リストに文字列を追加しています。
sales リストは以下のような文字列のリストになります。

sales = [
    "1,2,1,商品名,350,8,2016-11-5T00:00:00Z",
    ...
]

この値は書き込まれる「売上データ」の値です。
売上データを書き込む処理は分割されています。

with open('output/sales.csv'...) as f:
    for row in sales:
        ...

こうすることで「目的のデータを作る処理」と「ファイルに書き出す処理」にまとまりを分離できます。
分離することでwith文のインデントを1つ下げることもできました（深すぎるインデントは読みにくくなります）。

このように「関心事」、「まとまり」ごとに分割することで読みやすいプログラムに書き換えていけます。
